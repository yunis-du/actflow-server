syntax = "proto3";

package workflow;

// WorkflowService defines the gRPC service for managing workflows
service WorkflowService {
  // Run a workflow
  rpc RunWorkflow(RunWorkflowRequest) returns (stream WorkflowEvent) {}
  // Stop a running workflow
  rpc StopWorkflow(StopWorkflowRequest) returns (StopWorkflowResponse) {}
}


// Request to stop a workflow
message StopWorkflowRequest {
  string pid = 1;// Process ID of the workflow to stop
}

// Response after attempting to stop a workflow
message StopWorkflowResponse {
  bool success = 1;// Indicates if the stop operation was successful
  string err_msg = 2;// Error message if the operation failed
}

// Request to run a workflow
message RunWorkflowRequest {
  string workflow_model = 1;// JSON representation of the workflow
}

// Workflow events that can occur during the lifecycle of a workflow
message WorkflowEvent {
  oneof event {
    WorkflowStart workflow_start = 1;
    WorkflowSuccess workflow_success = 2;
    WorkflowFailure workflow_failure = 3;
    WorkflowAbort workflow_abort = 4;
    WorkflowPause workflow_pause = 5;

    NodeRunning node_running = 6;
    NodeStopped node_stopped = 7;
    NodePaused node_paused = 8;
    NodeSkipped node_skipped = 9;
    NodeSuccess node_success = 10;
    NodeError node_error = 11;
    NodeRetry node_retry = 12;

    NodeLog node_log = 13;
  }
}


// Events
message WorkflowStart {
  string pid = 1;
}

message WorkflowSuccess {
  string pid = 1;
}

message WorkflowFailure {
  string pid = 1;
  string err_msg = 2;
}

message WorkflowAbort {
  string pid = 1;
  string reason = 2;
}

message WorkflowPause {
  string pid = 1;
  string reason = 2;
}

message NodeRunning {
  string pid = 1;
  string nid = 2;
}

message NodeStopped {
  string pid = 1;
  string nid = 2;
}

message NodePaused {
  string pid = 1;
  string nid = 2;
  string reason = 3;
}

message NodeSkipped {
  string pid = 1;
  string nid = 2;
}

message NodeSuccess {
  string pid = 1;
  string nid = 2;
}

message NodeError {
  string pid = 1;
  string nid = 2;
  string err_msg = 3;
}

message NodeRetry {
  string pid = 1;
  string nid = 2;
}

message NodeLog {
  string pid = 1;
  string nid = 2;
  string content = 3;
  int64 timestamp = 4;
}